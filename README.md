# Parser_teleBot

## Описание

Parser_teleBot - это Telegram-бот, который помогает вам найти работу, соответствующую вашим желаниям. Бот использует передовые методы машинного обучения для поиска вакансий, соответствующих вашим ключевым словам
и желаемому местоположению..

## Установка

**1. Python:**

Убедитесь, что у вас установлен Python 3.10.

**2. Зависимости:**

Используйте `pip` для установки зависимостей:

pip install -r requirements.txt


**3. Создание бота:**

* **BotFather:** Зайдите в Telegram и найдите бота BotFather.
* **Создание:** Введите команду /newbot и следуйте инструкциям, чтобы создать нового бота.
* **Токен:** Вам будет предоставлен токен бота, который нужно сохранить в файле .env (BOT_TOKEN).

**4. Настройка PostgreSQL:**

* Установите PostgreSQL (можно использовать PgAdmin4).
* **Создание пользователя и пароля:** Создайте пользователя и пароль для доступа к базе данных.
* **Сохранение данных:** Запишите имя пользователя, пароль и имя базы данных в файле .env.

**5. Создание базы данных и таблиц:**

* **create_db.py:** Запустите этот файл, чтобы создать базу данных.
* **create_tables.py:** Запустите этот файл, чтобы создать таблицы в базе данных.
* **Filling_cities.py:** Запустите этот файл, чтобы заполнить таблицу городов.

## Запуск бота

* **main.py:** Запустите этот файл, чтобы запустить бота.

## Функции

### database:

* **insert_requests_data:**
#### описание:
* используется для добавления новой записи в таблицу requests базы данных "parserhh_db".
Эта запись содержит информацию о новом запросе на поиск вакансий. 
 

* **insert_response_data:**
#### Описание:
* Функция insert_response_data используется для добавления новой записи в таблицу response
базы данных "parserhh_db". Эта запись содержит информацию о найденной вакансии 
по конкретному запросу.



* **search_response_history:**
#### описание:
* Функция search_response_history используется для поиска записей в таблице response 
по заданным критериям.

### default_handlers

* **search_response_history:**
#### описание:
* Функция search_response_history используется для запуска диалога с пользователем,
позволяющего найти историю запросов по вакансиям в определенном городе.
Пользователь может запросить список городов или посмотреть историю своих запросов.


#### Логика работы:
* Отвечает на нажатие кнопки "История", предлагая варианты "Список городов" и "История запросов".
При выборе "Список городов", отображает список городов с кодами.
При выборе "История запросов", просит пользователя ввести код города.
Сохраняет введенный код города в глобальную переменную CITY_CODE.
Просит пользователя ввести название вакансии.
Сохраняет введенное название вакансии в глобальную переменную TITLE_JOB.
Передает управление в функцию search_vacancy_name2.


* **get_data_history:**
#### Описание:
* Функция get_data_history обрабатывает запрос на поиск истории запросов


#### Логика работы:


* Отвечает пользователю сообщением об обработке данных.
* Пытается найти записи в таблице response по CITY_CODE и TITLE_JOB.
* Если найдены записи:
* Создает и заполняет файл Excel данными о компаниях, сайтах и телефонах из найденных записей.
* Отправляет пользователю документ Excel с историей запросов.
* Если записи не найдены:
* Предлагает пользователю перейти в раздел "Парсинг" для поиска новых вакансий.


* **parsing:**
#### описание:
* Стартовая точка для парсинга вакансий. Позволяет пользователю выбрать город и начать поиск.


#### Логика:
* Отображает клавиатуру с кнопками "Список городов" и "Получить данные".
* При нажатии "Список городов", показывает список доступных городов.
* При нажатии "Получить данные", переводит пользователя в состояние StepsForm.GET_ID_CITY.


* **search_id_city:**
* 
* **get_vacancies:**
* 
* **search_city_code**:
* 
* **search_vacancy_name2:**



* **get_data:**

#### Описание: 
* Парсит вакансии по введенным городу и названию,
* сохраняет результаты и отправляет пользователю

#### Логика:
Вызывает функцию get_companies для парсинга вакансий.
Добавляет запись о запросе в таблицу requests с помощью insert_requests_data.
Для каждой найденной компании добавляет запись в таблицу response с помощью insert_response_data.
Создает DataFrame из результатов и сохраняет его в файл Excel.
Форматирует и отправляет пользователю файл Excel с результатами.

### parser:

* 1. get_employer_info(url):

#### Цель:
* Получить информацию о компании по предоставленному URL-адресу.

#### Логика:
* Отправляет GET-запрос на URL-адрес.
Обрабатывает возможные исключения запроса и выводит сообщение об ошибке.
Извлекает и возвращает name и site_url (если доступно) из JSON-ответа.

#### Возвращаемое значение: 
Словарь, содержащий информацию о компании (name, site_url),
или None в случае ошибки.

* 2. get_vacancies_hh(keyword, area):
 
#### Цель:
* Получить информацию о вакансиях, содержащую URL-адреса работодателей,
* соответствующие заданному ключевому слову и региону, с HeadHunter

#### Логика:
* Формирует URL-адрес API HeadHunter.
Итеративно извлекает данные с использованием пагинации:
Устанавливает параметры запроса (text, area, date_from, per_page, page).
Отправляет GET-запрос и обрабатывает возможные исключения.
Извлекает URL-адреса работодателей из каждой вакансии в ответе.
Извлекает информацию о компании с помощью get_employer_info для каждого URL-адреса.
Увеличивает номер страницы, пока не будут обработаны все страницы.

#### Возвращаемое значение:
* Список словарей, содержащих Компания (название компании) и 
Сайт (URL-адрес веб-сайта работодателя) для каждой совпавшей вакансии.

* 3. filter_and_create_dict(vacancies):

#### Цель:
* Отфильтровать компании с URL-адресами веб-сайтов и попытаться извлечь номера телефонов
с их веб-сайтов.

### Логика:
* Фильтрует компании с действительными URL-адресами веб-сайтов.
Перебирает отфильтрованные компании:
Отправляет GET-запрос на URL-адрес веб-сайта с таймаутом 5 секунд.
Обрабатывает возможные исключения запроса и выводит сообщение об ошибке.
Использует регулярные выражения для поиска номеров телефонов в тексте веб-сайта.
Добавляет в итоговый словарь только компании с непустыми номерами телефонов.
Выводит сообщения об ошибках, если номера телефонов не найдены.

#### Возвращаемое значение:
* Словарь, содержащий названия компаний в качестве ключей и словари 
со значениями Сайт и Телефон (номер телефона) для каждой компании 
с действительным номером телефона.



## Использование

* ... (команды и сценарии использования)

## Известные проблемы

* ... (известные проблемы)

## Планы развития

* Поиск вакансий: Бот может найти вакансии на различных сайтах по трудоустройству,
включая HeadHunter, Superjob, Indeed и другие

* Персонализация: Вы можете указать свои предпочтения, такие как желаемая зарплата, тип работы, график работы и т. д., 
чтобы бот мог найти вакансии, максимально соответствующие вашим требованиям.

* Уведомления: Бот может автоматически уведомлять вас о новых вакансиях,
соответствующих вашим критериям.

* 